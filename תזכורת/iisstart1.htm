<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>מערכת תזכורות מקצועית</title>

<style>
:root{
  --primary:#2E71B3; 
  --accent:#0F0880; 
  --dark:#1A1A1A; 
  --hover-row:#FFFFFF;
  --maxw:1650px;
}
body {
  font-family: Arial, sans-serif;
  direction: rtl;
  margin:0;
  padding:20px;
  background:#f0f2f5;
}
h1 { text-align:center; color:var(--primary); }

/* --- Header from CRM --- */
header{
  background:linear-gradient(90deg,var(--primary),var(--accent));
  color:#EBC26A;
  padding:16px 24px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 4px 6px rgba(0,0,0,.12);
  position:sticky;
  top:0;
  z-index:1000;
}
.logo{
  font-size:28px;
  font-weight:800;
  text-shadow:1px 1px 2px rgba(0,0,0,.15);
}
nav ul{
  list-style:none; margin:0; padding:0; display:flex; gap:8px; align-items:center;
}
nav a{
  color:white; text-decoration:none; padding:8px 12px; border-radius:6px; transition:background .18s; font-size:16px;
}
nav a:hover{ background:rgba(255,255,255,0.12); }
nav li{ position:relative; }
nav li ul{
  display:none;
  position:absolute;
  top:36px;
  right:0;
  background:var(--accent);
  padding:8px 0;
  border-radius:4px;
  min-width:180px;
}
nav li:hover ul{ display:block; }
nav li ul a{ display:block; padding:8px 14px; color:#FFFFFF; }

/* --- Card/Table styles from Reminder --- */
.card { background:#fff; padding:20px; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,.1); margin-bottom:20px; transition: transform 0.3s ease; }
.card:hover { transform: translateY(-2px); }
table { width:100%; border-collapse:collapse; margin-top:10px; }
th,td { padding:10px; border-bottom:1px solid #ddd; text-align:center; }
th { cursor:pointer; background:#f9f9f9; }
tr:hover { background:#f1f1f1; }
button { padding:8px 14px; border:none; border-radius:8px; cursor:pointer; margin:2px; font-weight:bold; transition: all 0.3s ease; }
button:hover { opacity:0.85; transform:scale(1.05); }
.add-btn { background:#49C449; color:white; }
.edit-btn { background:#5bc0de; color:white; }
.delete-btn { background:#F52116; color:white; }
.done-btn, .defer-btn { background:#FFA500; color:white; }

#toast { position:fixed; top:30px; right:50%; transform:translateX(50%); padding:12px 20px; border-radius:8px; opacity:0; pointer-events:none; transition:opacity .4s, transform .4s; z-index:2000; color:#fff; }
#toast.success { background:green; }
#toast.error { background:red; }
#toast.info { background:#555; }
#toast.show { opacity:1; transform:translateX(50%) translateY(0); }

input,select { padding:8px; width:20%; margin:5px 0; border-radius:8px; border:1px solid #ccc; box-sizing:border-box; transition: all 0.3s ease; }
input:focus, select:focus { border-color:var(--primary); outline:none; box-shadow:0 0 5px rgba(46,113,179,0.5); }
.search-box { margin-bottom:10px; display:flex; gap:6px; flex-wrap:wrap; }
.pagination { display:flex; justify-content:center; margin-top:10px; gap:6px; flex-wrap:wrap; }
.pagination button { padding:6px 10px; border-radius:6px; }

.popup-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.4); display:flex; align-items:center; justify-content:center; z-index:3000; opacity:0; pointer-events:none; transition: opacity 0.3s ease; }
.popup-overlay.show { opacity:1; pointer-events:auto; }
.popup { background:#fff; padding:20px; border-radius:12px; max-width:400px; max-height:80vh; overflow-y:auto; box-shadow:0 8px 20px rgba(0,0,0,0.3); transform:translateY(-50px); transition: transform 0.3s ease; }
.popup.show { transform:translateY(0); }
.popup h3 { margin-top:0; }
.popup button { width:100%; margin:5px 0; }

</style>
</head>
<body>

<!-- Header from CRM -->
<header>
  <div class="logo">מערכת תזכורות מקצועית</div>
  <nav>
    <ul>
      <li><a href="http://192.168.7.11/">🏠בית</a></li>
      <li><a href="http://192.168.7.11/%D7%90%D7%A0%D7%9C%D7%99%D7%98%D7%99%D7%A7%D7%A1%20%D7%A0%D7%99%D7%94%D7%95%D7%9C%20%D7%9C%D7%A7%D7%95%D7%97%D7%95%D7%AA/analytics.htm">📊דוחות</a></li>
      <li><a href="http://192.168.7.11/heshboniot/heshbonit.htm">חשבוניות</a></li>
    </ul>
  </nav>
</header>

<h1>תזכורות</h1>

<div class="card">
  <h2>הוספת תזכורת חדשה</h2>
  <select id="reminderCustomer">
      <option value="">בחר לקוח</option>
  </select>
  <input type="text" id="reminderText" placeholder="תיאור התזכורת">
  <input type="datetime-local" id="reminderTime">
  <button class="add-btn" onclick="addReminder()">💾 הוסף תזכורת</button>
  <button class="delete-btn" onclick="deleteAllReminders()">🗑️ מחק הכל</button>
</div>

<div class="card">
  <div class="search-box">
      <input type="text" id="searchInput" placeholder="חיפוש תזכורות">
      <button onclick="searchReminder()">🔍 חפש</button>
      <button onclick="resetSearch()">🧹 איפוס</button>
  </div>

  <table id="reminderTable">
  <thead>
  <tr>
  <th>#</th>
  <th>לקוח</th>
  <th>תזכורת</th>
  <th>תאריך ושעה</th>
  <th>סטטוס</th>
  <th>פעולות</th>
  </tr>
  </thead>
  <tbody></tbody>
  </table>
  <div class="pagination" id="pagination"></div>
</div>

<div id="toast"></div>

<!-- Popup -->
<div class="popup-overlay" id="popupOverlay">
    <div class="popup" id="popupContent"></div>
</div>

<script>
// ====== Security Header Scripts ======
// מניעת מקש ימני
document.addEventListener('contextmenu', function(e){
  e.preventDefault();
  toast("פעולה זו מנועה", "error");
});

// מניעת Ctrl+C / Ctrl+X / Ctrl+U
document.addEventListener('keydown', function(e){
  if (e.ctrlKey && (e.key === 'c' || e.key === 'x' || e.key === 'u')) {
    e.preventDefault();
    toast("פעולה זו מנועה", "error");
  }
});

// זמן ניתוק אוטומטי
const AUTO_LOGOUT_MINUTES = 5;
let logoutTimer;
function resetLogoutTimer() {
  clearTimeout(logoutTimer);
  logoutTimer = setTimeout(() => {
    toast("אין פעילות – התנתקת אוטומטית", "error");
    // כאן אפשר לממש logout של המערכת
  }, AUTO_LOGOUT_MINUTES * 60 * 1000);
}
['mousemove', 'keydown', 'scroll', 'click'].forEach(evt => { document.addEventListener(evt, resetLogoutTimer); });
window.addEventListener('DOMContentLoaded', resetLogoutTimer);

// ====== Reminder System Scripts ======
(function(){
    let customers = JSON.parse(localStorage.getItem('customers')) || [{id:1,name:'דוד לוי'},{id:2,name:'רונית כהן'}];
    let reminders = JSON.parse(localStorage.getItem('reminders')) || [];
    let currentPage = 0;
    const PAGE_SIZE = 5;

    function saveData(){ localStorage.setItem('reminders',JSON.stringify(reminders)); }

    function toast(msg,type="info"){
        const t = document.getElementById('toast');
        t.innerText = msg;
        t.className = 'show ' + type;
        setTimeout(()=>t.className='',3000);
    }

    function populateCustomerDropdown() {
        const sel = document.getElementById('reminderCustomer');
        sel.innerHTML="<option value=''>בחר לקוח</option>";
        customers.forEach(c=>{ sel.innerHTML += `<option value="${c.id}">${c.name}</option>` });
    }
    populateCustomerDropdown();

    window.addReminder = function(){
        const custId = document.getElementById('reminderCustomer').value;
        const text = document.getElementById('reminderText').value.trim();
        const time = document.getElementById('reminderTime').value;
        if(!custId||!text||!time){ toast("מלא את כל השדות","error"); return; }
        reminders.push({id:Date.now(),customer:customers.find(c=>c.id==custId).name,text,time,status:"פעיל"});
        saveData(); renderTable(); toast("תזכורת נוספה","success");
        document.getElementById('reminderText').value=''; document.getElementById('reminderTime').value='';
    }

    function renderTable(){
        const tbody = document.querySelector('#reminderTable tbody');
        tbody.innerHTML="";
        const start = currentPage*PAGE_SIZE;
        const pageData = reminders.slice(start,start+PAGE_SIZE);
        if(pageData.length===0){ tbody.innerHTML='<tr><td colspan="6">אין תזכורות</td></tr>'; }
        pageData.forEach((r,i)=>{
            const tr=document.createElement('tr');
            tr.innerHTML=`<td>${start+i+1}</td><td>${r.customer}</td><td>${r.text}</td><td>${r.time}</td><td>${r.status}</td>
            <td>
                <button class="done-btn" onclick="markDone(${r.id})">בוצע</button>
                <button class="defer-btn" onclick="deferReminder(${r.id})">דחה</button>
                <button class="delete-btn" onclick="deleteReminder(${r.id})">מחק</button>
            </td>`;
            tbody.appendChild(tr);
        });
        renderPagination();
    }

    function renderPagination(){
        const div = document.getElementById('pagination');
        div.innerHTML="";
        const totalPages = Math.ceil(reminders.length/PAGE_SIZE);
        for(let i=0;i<totalPages;i++){
            const btn = document.createElement('button');
            btn.innerText=i+1;
            if(i===currentPage){ btn.style.fontWeight="bold"; btn.style.background="#ccc"; }
            btn.onclick = ()=>{ currentPage=i; renderTable(); }
            div.appendChild(btn);
        }
    }

    window.deleteReminder = function(id){ reminders = reminders.filter(r=>r.id!==id); saveData(); renderTable(); toast("תזכורת נמחקה","success"); }
    window.markDone = function(id){ reminders.find(r=>r.id===id).status="בוצע"; saveData(); renderTable(); toast("סומן כבוצע","success"); }
    window.deferReminder = function(id){ reminders.find(r=>r.id===id).status="דחה"; saveData(); renderTable(); toast("סומן כדחוי","info"); }
    window.deleteAllReminders = function(){ if(confirm("למחוק את כל התזכורות?")){ reminders=[]; saveData(); renderTable(); toast("כל התזכורות נמחקו","success"); } }
    window.searchReminder = function(){ const term=document.getElementById('searchInput').value.trim().toLowerCase(); if(!term){ renderTable(); return; } reminders = reminders.filter(r=>r.customer.toLowerCase().includes(term) || r.text.toLowerCase().includes(term)); renderTable(); }
    window.resetSearch = function(){ document.getElementById('searchInput').value=''; reminders=JSON.parse(localStorage.getItem('reminders'))||[]; renderTable(); }

    renderTable();
})();
</script>
</body>
</html>
