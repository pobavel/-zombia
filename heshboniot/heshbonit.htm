<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>חשבונית מקצועית — CRM</title>
<style>
body {
  font-family:'Segoe UI',Tahoma,sans-serif;
  margin:0; padding:0;
  direction:rtl;
  background:#f5f7fa;
  color:#333;
}

/* Header עם ניווט */
header {
  background:#1E3A8A;
  color:white;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 25px;
  box-shadow:0 3px 6px rgba(0,0,0,0.1);
}

header .logo {
  font-size:24px;
  font-weight:bold;
  letter-spacing:1px;
}

header nav a {
  color:white;
  text-decoration:none;
  margin-left:20px;
  font-size:18px;
  transition:0.2s;
}

header nav a:hover {
  color:#FFD700;
}

#controls {
  max-width:900px;
  margin:25px auto;
  display:flex;
  gap:12px;
  flex-wrap:wrap;
}

select,input,button {
  padding:12px;
  font-size:16px;
  border-radius:6px;
  border:1px solid #ccc;
  box-sizing:border-box;
}

input, select { flex:1; min-width:180px; }
button {
  background:#1E3A8A;
  color:white;
  cursor:pointer;
  border:none;
  transition:0.2s;
  min-width:150px;
}
button:hover{ background:#0F2C66; }

#invoicePrint {
  display:none;
  width:210mm;
  min-height:297mm;
  margin:30px auto;
  padding:25mm;
  box-sizing:border-box;
  background:white;
  box-shadow:0 0 20px rgba(0,0,0,0.15);
  border-radius:10px;
}

#invoicePrint h2 {
  text-align:center;
  margin-bottom:25px;
  font-size:32px;
  color:#1E3A8A;
  letter-spacing:1px;
}

.invoice-header {
  display:flex;
  justify-content:space-between;
  margin-bottom:25px;
  border-bottom:2px solid #E0E7FF;
  padding-bottom:15px;
}

.invoice-header .client-info, .invoice-header .invoice-info {
  width:48%;
}

.invoice-header div { margin-bottom:10px; font-size:16px; }

#invoicePrint table {
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
  font-size:16px;
}

#invoicePrint th, #invoicePrint td {
  border:1px solid #ccc;
  padding:12px;
  text-align:center;
}

#invoicePrint th {
  background:#E0E7FF;
  color:#1E3A8A;
  font-weight:600;
}

#invoicePrint .footer {
  margin-top:25px;
  font-size:20px;
  font-weight:bold;
  text-align:right;
  color:#1E3A8A;
}

@media print {
  body * { visibility:hidden; }
  #invoicePrint, #invoicePrint * { visibility:visible; }
  #invoicePrint { position:absolute; top:0; left:0; width:100%; height:auto; }
}
</style>
</head>
<body>

<header>
  <div class="logo">CRM מקצועי</div>
  <nav>
    <a href="http://zombia.co.il">בית</a>
    <a href="http://zombia.co.il/%D7%AA%D7%96%D7%9B%D7%95%D7%A8%D7%AA/iisstart1.htm">תזכורות</a>
    <a href="http://zombia.co.il/%D7%90%D7%A0%D7%9C%D7%99%D7%98%D7%99%D7%A7%D7%A1%20%D7%A0%D7%99%D7%94%D7%95%D7%9C%20%D7%9C%D7%A7%D7%95%D7%97%D7%95%D7%AA/analytics.htm">דוחות אנליטיקס</a>
  </nav>
</header>

<div id="controls">
  <input type="text" id="searchClient" placeholder="חפש לקוח לפי שם">
  <select id="clientSelect">
    <option value="">-- בחר לקוח --</option>
  </select>
  <button onclick="printInvoice()">הדפס חשבונית</button>
</div>

<div id="invoicePrint">
  <h2>חשבונית מס דיגיטלית</h2>

  <div class="invoice-header">
    <div class="client-info">
      <div><strong>שם:</strong> <span id="invName"></span></div>
      <div><strong>אימייל:</strong> <span id="invEmail"></span></div>
      <div><strong>נייד:</strong> <span id="invMobile"></span></div>
      <div><strong>סטטוס:</strong> <span id="invStatus"></span></div>
    </div>
    <div class="invoice-info">
      <div><strong>תאריך:</strong> <span id="invDate"></span></div>
      <div><strong>מספר חשבונית:</strong> <span id="invNumber"></span></div>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th>פריט</th>
        <th>כמות</th>
        <th>מחיר</th>
        <th>סה"כ</th>
      </tr>
    </thead>
    <tbody id="invoiceItems"></tbody>
  </table>

  <div class="footer">סה"כ לתשלום: <span id="invTotal"></span></div>
</div>

<script>
// דוגמא לנתוני CRM (ניתן לשנות/להוסיף לקוחות)
let customers = JSON.parse(localStorage.getItem('customers')) || [
  {id:'c001', name:'יוסי כהן', email:'yossi@test.com', mobile:'0501234567', status:'פעיל', amount:250},
  {id:'c002', name:'דנה לוי', email:'dana@test.com', mobile:'0527654321', status:'לא פעיל', amount:400}
];
let inactive = JSON.parse(localStorage.getItem('inactive')) || [];
let archive = JSON.parse(localStorage.getItem('archive')) || [];
let allClients = [...customers, ...inactive, ...archive];

const clientSelect = document.getElementById('clientSelect');

// פונקציה למילוי רשימת הלקוחות
function populateClients(list){
  clientSelect.innerHTML = '<option value="">-- בחר לקוח --</option>';
  list.forEach(c=>{
    let opt = document.createElement('option');
    opt.value = c.id;
    opt.textContent = c.name;
    clientSelect.appendChild(opt);
  });
}
populateClients(allClients);

// חיפוש לקוחות
document.getElementById('searchClient').addEventListener('input', function(){
  const term = this.value.trim().toLowerCase();
  const filtered = allClients.filter(c => c.name.toLowerCase().includes(term));
  populateClients(filtered);
});

// מספר החשבונית האחרון
let lastInvoiceNumber = parseInt(localStorage.getItem('lastInvoiceNumber') || '0');

// בחירת לקוח והצגת החשבונית
clientSelect.addEventListener('change', function(){
  const id = this.value;
  if(!id){ document.getElementById('invoicePrint').style.display='none'; return; }
  const client = allClients.find(c=>c.id===id);
  if(!client) return;

  document.getElementById('invoicePrint').style.display='block';
  document.getElementById('invName').textContent = client.name;
  document.getElementById('invEmail').textContent = client.email;
  document.getElementById('invMobile').textContent = client.mobile;
  document.getElementById('invStatus').textContent = client.status;
  document.getElementById('invDate').textContent = new Date().toLocaleDateString('he-IL');

  // חישוב מספר חשבונית אוטומטי
  lastInvoiceNumber++;
  localStorage.setItem('lastInvoiceNumber', lastInvoiceNumber);
  document.getElementById('invNumber').textContent = String(lastInvoiceNumber).padStart(8,'0');

  const items = client.items || [{name:'סרטים וסדרות שרת פלקס', qty:1, price:client.amount || 0}];
  const tbody = document.getElementById('invoiceItems');
  tbody.innerHTML='';
  let total=0;
  items.forEach(it=>{
    const sum = it.qty*it.price;
    total += sum;
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${it.name}</td><td>${it.qty}</td><td>${it.price.toLocaleString('he-IL',{style:'currency',currency:'ILS'})}</td><td>${sum.toLocaleString('he-IL',{style:'currency',currency:'ILS'})}</td>`;
    tbody.appendChild(tr);
  });
  document.getElementById('invTotal').textContent = total.toLocaleString('he-IL',{style:'currency',currency:'ILS'});
});

// פונקציה להדפסת החשבונית
function printInvoice(){
  const inv = document.getElementById('invoicePrint');
  if(inv.style.display==='none'){ alert('בחר לקוח קודם'); return; }
  window.print();
}
</script>
</body>
</html>
